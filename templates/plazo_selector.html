{% extends "base.html" %}

{% block title %}{{ producto.nombre }} - Selecciona tu plazo | MoneyMax{% endblock %}

{% block head %}
<style>
/* ──────────── CSS VARIABLES ──────────── */
:root {
    --product-color: {{ producto.color_fondo }};
    --product-color-light: {{ producto.color_fondo }}20;
    --product-color-lighter: {{ producto.color_fondo }}10;
    --product-color-dark: {{ producto.color_fondo }}dd;
    --product-focus-shadow: {{ producto.color_fondo }}1a;
}

/* ──────────── ESTILOS ──────────── */
.product-header {
    background: linear-gradient(135deg, var(--product-color), var(--product-color-dark));
    color: white;
    padding: 3rem 0;
}

.plazo-card {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 16px;
    padding: 2rem;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
}

.plazo-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
    border-color: var(--product-color);
}

.plazo-card.destacado {
    border-color: var(--product-color);
    background: linear-gradient(135deg, #f8fafc, #ffffff);
    box-shadow: 0 4px 12px var(--product-focus-shadow);
}

.plazo-card.destacado::before {
    content: '⭐ RECOMENDADO';
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--product-color);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 600;
    letter-spacing: 0.5px;
}

.plazo-nombre {
    font-size: 1.5rem;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 0.5rem;
}

.plazo-tasa {
    font-size: 2rem;
    font-weight: 800;
    color: var(--product-color);
    margin-bottom: 0.5rem;
}

.plazo-descripcion {
    color: #718096;
    font-size: 0.9rem;
}

.plazo-badge {
    display: inline-block;
    background: var(--product-color-light);
    color: var(--product-color);
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
    margin-top: 0.5rem;
    border: 1px solid var(--product-color);
}

.back-button {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(255, 255, 255, 0.2);
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
    margin-bottom: 2rem;
}

.back-button:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateX(-2px);
}

.steps-indicator {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
}

.step {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: white;
}

.step.active {
    background: var(--product-color);
}

.step.completed {
    background: #48bb78;
}

.step.inactive {
    background: #cbd5e0;
}

.step-divider {
    width: 40px;
    height: 2px;
    background: #cbd5e0;
}

.step-divider.completed {
    background: #48bb78;
}

.section-icon {
    width: 24px;
    height: 24px;
    background: var(--product-color);
    border-radius: 6px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-right: 0.5rem;
}

.section-icon::before {
    content: '';
    width: 12px;
    height: 12px;
    background: white;
    border-radius: 2px;
}

.info-highlight {
    color: var(--product-color);
}

/* Responsive */
@media (max-width: 768px) {
    .product-header {
        padding: 2rem 0;
    }
    
    .product-header > .container > div:first-of-type {
        flex-direction: column;
        text-align: center;
        gap: 1rem !important;
    }
    
    .plazo-card {
        padding: 1.5rem;
    }
    
    .steps-indicator {
        margin-bottom: 1rem;
    }
}
</style>
{% endblock %}

{% block content %}
<!-- Product Header -->
<section class="product-header">
    <div class="container">
        <a href="/" class="back-button">
            ← Regresar
        </a>
        
        <div style="display: flex; align-items: center; gap: 2rem; margin-bottom: 2rem;">
            <!-- Logo del producto -->
            <div style="width: 100px; height: 100px; background: rgba(255, 255, 255, 0.2); border-radius: 16px; display: flex; align-items: center; justify-content: center;">
                {% if producto.logo %}
                    <img src="{{ producto.logo }}" alt="{{ producto.nombre }}" style="width: 80px; height: 80px; object-fit: contain; border-radius: 12px;">
                {% else %}
                    <div style="font-size: 2.5rem; font-weight: bold; color: white;">
                        {% set words = producto.nombre.split() %}
                        {% if words|length == 1 %}
                            {{ producto.nombre[:2].upper() }}
                        {% else %}
                            {{ words[0][0].upper() + words[1][0].upper() }}
                        {% endif %}
                    </div>
                {% endif %}
            </div>
            
            <!-- Info del producto -->
            <div>
                <h1 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">{{ producto.nombre }}</h1>
                <p style="font-size: 1.2rem; opacity: 0.9;">{{ producto.descripcion }}</p>
                {% if producto.badge %}
                    <span style="display: inline-block; background: rgba(255,255,255,0.3); padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600; margin-top: 0.5rem;">
                        {{ producto.badge }}
                    </span>
                {% endif %}
            </div>
        </div>
        
        <!-- Steps indicator -->
        <div class="steps-indicator">
            <div class="step active">1</div>
            <div class="step-divider"></div>
            <div class="step inactive">2</div>
            <div class="step-divider"></div>
            <div class="step inactive">3</div>
        </div>
        
        <div style="text-align: center; color: rgba(255, 255, 255, 0.8); font-size: 0.9rem;">
            Paso 1 de 3 - <strong>Selecciona tu plazo</strong>
        </div>
    </div>
</section>

<!-- Plazo Selection -->
<section style="padding: 4rem 0;">
    <div class="container">
        <div style="text-align: center; margin-bottom: 3rem;">
            <h2 style="font-size: 2rem; font-weight: 700; color: #2d3748; margin-bottom: 1rem; display: flex; align-items: center; justify-content: center;">
                <span class="section-icon"></span>
                Elige tu plazo de inversión
            </h2>
            <p style="font-size: 1.1rem; color: #718096;">
                Cada plazo tiene una tasa diferente. Puedes comparar todas las opciones disponibles.
            </p>
        </div>
        
        <!-- Grid de plazos -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem; max-width: 1200px; margin: 0 auto;">
            {% for plazo_dias, plazo_info in producto.plazos.items() %}
            <div class="plazo-card {% if loop.first %}destacado{% endif %}" 
                 onclick="window.location.href='/calculator/{{ producto_id }}/{{ plazo_dias }}'">
                
                <div class="plazo-nombre">{{ plazo_info.nombre }}</div>
                <div class="plazo-tasa">{{ "%.2f"|format(plazo_info.tasa_anual) }}%</div>
                <div class="plazo-descripcion">{{ plazo_info.descripcion }}</div>
                
                <!-- Badges para tipos de inversión disponibles -->
                {% if plazo_info.permite_inversion_unica and plazo_info.permite_inversion_mensual %}
                    <div class="plazo-badge">Única + Mensual</div>
                {% elif plazo_info.permite_inversion_unica %}
                    <div class="plazo-badge">Solo inversión única</div>
                {% elif plazo_info.permite_inversion_mensual %}
                    <div class="plazo-badge">Solo inversión mensual</div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        
        <!-- Info adicional -->
        <div style="background: #f7fafc; border-radius: 12px; padding: 2rem; margin-top: 3rem; max-width: 800px; margin-left: auto; margin-right: auto; border: 1px solid #e2e8f0;">
            <h3 style="font-size: 1.2rem; font-weight: 600; color: #2d3748; margin-bottom: 1rem; display: flex; align-items: center;">
                <span style="width: 20px; height: 20px; background: var(--product-color); border-radius: 4px; display: inline-flex; align-items: center; justify-content: center; margin-right: 0.5rem;">
                    <span style="width: 10px; height: 10px; background: white; border-radius: 2px;"></span>
                </span>
                Vista previa del plazo seleccionado
            </h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1.5rem;">
                <div>
                    <div style="color: #718096; font-size: 0.9rem; margin-bottom: 0.25rem;">Plazo:</div>
                    <div style="font-weight: 600; color: #2d3748; font-size: 1.1rem;" id="selected-plazo">Pasa el cursor sobre un plazo</div>
                </div>
                
                <div>
                    <div style="color: #718096; font-size: 0.9rem; margin-bottom: 0.25rem;">Tasa anual:</div>
                    <div style="font-weight: 700; font-size: 1.1rem;" class="info-highlight" id="selected-tasa">-</div>
                </div>
                
                <div>
                    <div style="color: #718096; font-size: 0.9rem; margin-bottom: 0.25rem;">Tipos disponibles:</div>
                    <div style="font-weight: 600; color: #2d3748; font-size: 1.1rem;" id="selected-tipos">-</div>
                </div>
                
                <div>
                    <div style="color: #718096; font-size: 0.9rem; margin-bottom: 0.25rem;">Monto sugerido:</div>
                    <div style="font-weight: 600; color: #2d3748; font-size: 1.1rem;">$1,000 MXN</div>
                </div>
            </div>
            
            <div style="margin-top: 1.5rem; padding: 1rem; background: white; border-radius: 8px; border-left: 4px solid var(--product-color);">
                <div style="font-size: 0.9rem; color: #4a5568; line-height: 1.5;">
                    💡 <strong>Tip:</strong> Los plazos más cortos permiten reinvertir más frecuentemente, 
                    mientras que los plazos largos pueden ofrecer tasas más estables.
                </div>
            </div>
        </div>
        
        <!-- Call to action -->
        <div style="text-align: center; margin-top: 2rem;">
            <p style="color: #718096; font-size: 0.9rem;">
                Haz clic en cualquier plazo para continuar con tu cálculo →
            </p>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
// Manejar selección de plazo
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.plazo-card');
    
    // Datos de plazos desde el servidor
    const plazosData = {{ producto.plazos | tojson }};
    
    cards.forEach((card, index) => {
        card.addEventListener('mouseenter', function() {
            // Obtener información del plazo
            const nombre = this.querySelector('.plazo-nombre').textContent;
            const tasa = this.querySelector('.plazo-tasa').textContent;
            
            // Obtener el plazo_dias del onclick
            const href = this.getAttribute('onclick');
            const plazoMatch = href.match(/\/calculator\/[^\/]+\/(\d+)/);
            const plazoDias = plazoMatch ? plazoMatch[1] : null;
            
            // Obtener info de tipos disponibles
            let tiposDisponibles = '-';
            if (plazoDias && plazosData[plazoDias]) {
                const plazoInfo = plazosData[plazoDias];
                const unica = plazoInfo.permite_inversion_unica;
                const mensual = plazoInfo.permite_inversion_mensual;
                
                if (unica && mensual) {
                    tiposDisponibles = 'Única + Mensual';
                } else if (unica) {
                    tiposDisponibles = 'Solo única';
                } else if (mensual) {
                    tiposDisponibles = 'Solo mensual';
                }
            }
            
            // Actualizar detalles
            document.getElementById('selected-plazo').textContent = nombre;
            document.getElementById('selected-tasa').textContent = tasa;
            document.getElementById('selected-tipos').textContent = tiposDisponibles;
            
            // Efecto visual adicional
            cards.forEach(c => c.style.opacity = c === this ? '1' : '0.7');
        });
        
        card.addEventListener('mouseleave', function() {
            // Restaurar opacidad
            cards.forEach(c => c.style.opacity = '1');
        });
    });
    
    // Resetear cuando el mouse sale del área de cards
    const container = document.querySelector('section[style*="padding: 4rem 0"]');
    container.addEventListener('mouseleave', function() {
        document.getElementById('selected-plazo').textContent = 'Pasa el cursor sobre un plazo';
        document.getElementById('selected-tasa').textContent = '-';
        document.getElementById('selected-tipos').textContent = '-';
        
        // Restaurar opacidad de todas las cards
        cards.forEach(c => c.style.opacity = '1');
    });
    
    // Mejorar la experiencia de click
    cards.forEach(card => {
        card.addEventListener('click', function() {
            // Efecto de loading antes de navegar
            this.style.transform = 'scale(0.98)';
            this.style.opacity = '0.8';
            
            setTimeout(() => {
                // El onclick original se ejecutará
                eval(this.getAttribute('onclick'));
            }, 100);
        });
    });
});
</script>
{% endblock %}